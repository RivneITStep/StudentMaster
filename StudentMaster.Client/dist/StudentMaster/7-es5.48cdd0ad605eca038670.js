function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var c=e[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"2+oU":function(t,e,n){"use strict";n.r(e);var c=n("ofXK"),o=n("tyNb"),a=n("Gpoy"),i=n("ey9i"),s=n("D7qI"),r=n("y8gV"),l=n("fXoL"),b=n("Wp6s"),u=n("MutI"),g=n("f0Cb"),m=n("kmnG"),h=n("qFsG"),d=n("3Pt+"),f=n("bTqV"),p=n("FKr1");function v(t,e){if(1&t&&l.Tb(0,"img",15),2&t){var n=l.kc().$implicit,c=l.kc();l.qc("src",c.imgAPI+n.url,l.Fc)}}function w(t,e){1&t&&l.Tb(0,"img",16)}function C(t,e){if(1&t){var n=l.Zb();l.Yb(0,"mat-list-option",11),l.gc("click",(function(t){l.Dc(n);var c=e.$implicit;return l.kc().onContactChange(c.id)})),l.Kc(1,v,1,1,"img",12),l.Kc(2,w,1,0,"img",13),l.Yb(3,"h3",14),l.Mc(4),l.Xb(),l.Xb()}if(2&t){var c=e.$implicit;l.qc("selected",c.selected),l.Eb(1),l.qc("ngIf",null!==c.url),l.Eb(1),l.qc("ngIf",null===c.url),l.Eb(2),l.Oc(" ",c.pib," ")}}function k(t,e){if(1&t&&l.Tb(0,"img",23),2&t){var n=l.kc().$implicit,c=l.kc();l.qc("src",c.imgAPI+n.senderAvatar,l.Fc)}}function y(t,e){1&t&&l.Tb(0,"img",24)}function M(t,e){if(1&t&&(l.Yb(0,"mat-list-item",17),l.Kc(1,k,1,1,"img",18),l.Kc(2,y,1,0,"img",19),l.Yb(3,"h3",20),l.Yb(4,"b"),l.Mc(5),l.Xb(),l.Mc(6,": "),l.Yb(7,"span",21),l.Mc(8),l.Xb(),l.Xb(),l.Yb(9,"div",14),l.Yb(10,"div",22),l.Mc(11),l.Xb(),l.Xb(),l.Xb()),2&t){var n=e.$implicit;l.Eb(1),l.qc("ngIf",null!==n.senderAvatar),l.Eb(1),l.qc("ngIf",null===n.senderAvatar),l.Eb(2),l.Jc("color",n.color),l.Eb(1),l.Nc(n.senderPib),l.Eb(3),l.Nc(n.date),l.Eb(3),l.Oc(" ",n.message," ")}}var _,X,A=[{path:"",component:(_=function(){function t(e,n){_classCallCheck(this,t),this.tools=e,this.authService=n,this.contacts=[],this.messages=[],this.selectedId="",this.message="",this.imgAPI=""}return _createClass(t,[{key:"ngOnInit",value:function(){this.imgAPI=i.d,this.connect()}},{key:"connect",value:function(){var t=this;this._hubConnection=(new a.b).withUrl(i.a+"/api/hubs/chat",{transport:a.a.WebSockets,accessTokenFactory:function(){return window.localStorage.getItem(i.e)}}).build(),this._hubConnection.start().then((function(){t.tools.showNotification("Connected to the chat"),t._hubConnection.invoke("getMyContactsAsync").catch((function(e){return t.Handler(e)}))})).catch((function(e){t.tools.showNotification("Error while starting connection"),console.log("Error while starting connection: "+e)})),this._hubConnection.on("Recive",(function(t){console.log(t)})),this._hubConnection.on("ReciveMessage",(function(e){t.messages.push(e),t.goDown()})),this._hubConnection.on("ReciveMessages",(function(e){t.messages=e,t.goDown()})),this._hubConnection.on("reciveContacts",(function(e){console.log(e),t.contacts=e,t.contacts.forEach((function(t){t.selected=!1}))}))}},{key:"Send",value:function(){var t=this;this._hubConnection.invoke("SendToAsync",this.message,this.selectedId).catch((function(e){return t.Handler(e)})),this.message=""}},{key:"onContactChange",value:function(t){var e=this;this.selectedId=t,this.messages=[],this.contacts.forEach((function(n){!0===n.selected&&(n.selected=!1),n.id===t&&(n.selected=!0,e._hubConnection.invoke("getAllMessageWithUser",t).catch((function(t){return e.Handler(t)})))}))}},{key:"goDown",value:function(){var t=document.querySelector(".chat");setTimeout((function(){t.scrollTop=t.scrollHeight}),0)}},{key:"Handler",value:function(t){var e=this;-1!==t.message.toString().indexOf("because user is unauthorized")&&(this._hubConnection.stop(),this.authService.Refresh().subscribe((function(){e.connect()})))}}]),t}(),_.\u0275fac=function(t){return new(t||_)(l.Sb(s.a),l.Sb(r.a))},_.\u0275cmp=l.Mb({type:_,selectors:[["app-chat"]],decls:20,vars:5,consts:[[1,"row","container-fluid","chat-container"],[1,"cell-md-4","cell-12","contacts"],[3,"selected","click",4,"ngFor","ngForOf"],[1,"cell-md-8","cell-12"],[1,"chat"],["tdMediaToggle","gt-xs"],["class","pad-top pad-bottom",4,"ngFor","ngForOf"],["layout","row","layout-align","start center"],["flex","","layout","row","floatPlaceholder","never",2,"width","100%"],["matInput","","placeholder","message",2,"width","100%",3,"ngModel","ngModelChange"],["type","submit","color","primary","mat-raised-button","","mat-button","",3,"disabled","click"],[3,"selected","click"],["matListAvatar","","alt","",3,"src",4,"ngIf"],["matListAvatar","","src","https://banner2.cleanpng.com/20180430/jge/kisspng-computer-icons-font-awesome-hamburger-button-5ae723a4ebfc72.3953800615250973809666.jpg","alt","",4,"ngIf"],["matLine",""],["matListAvatar","","alt","",3,"src"],["matListAvatar","","src","https://banner2.cleanpng.com/20180430/jge/kisspng-computer-icons-font-awesome-hamburger-button-5ae723a4ebfc72.3953800615250973809666.jpg","alt",""],[1,"pad-top","pad-bottom"],["matListAvatar","","matListAvatar","","alt","",3,"src",4,"ngIf"],["matListAvatar","","matListAvatar","","src","https://banner2.cleanpng.com/20180430/jge/kisspng-computer-icons-font-awesome-hamburger-button-5ae723a4ebfc72.3953800615250973809666.jpg","alt","",4,"ngIf"],["matLine","",1,"cursor-pointer"],[1,"tc-grey-500","md-caption"],[1,"text-wrap",2,"word-wrap","break-word"],["matListAvatar","","matListAvatar","","alt","",3,"src"],["matListAvatar","","matListAvatar","","src","https://banner2.cleanpng.com/20180430/jge/kisspng-computer-icons-font-awesome-hamburger-button-5ae723a4ebfc72.3953800615250973809666.jpg","alt",""]],template:function(t,e){1&t&&(l.Yb(0,"div",0),l.Yb(1,"mat-card",1),l.Yb(2,"mat-card-subtitle"),l.Mc(3,"Contacts"),l.Xb(),l.Yb(4,"mat-selection-list"),l.Kc(5,C,5,4,"mat-list-option",2),l.Xb(),l.Xb(),l.Yb(6,"div",3),l.Yb(7,"div",4),l.Yb(8,"mat-card",5),l.Yb(9,"mat-card-subtitle"),l.Mc(10),l.Xb(),l.Yb(11,"mat-list"),l.Kc(12,M,12,7,"mat-list-item",6),l.Xb(),l.Xb(),l.Xb(),l.Tb(13,"mat-divider"),l.Yb(14,"mat-card"),l.Yb(15,"div",7),l.Yb(16,"mat-form-field",8),l.Yb(17,"textarea",9),l.gc("ngModelChange",(function(t){return e.message=t})),l.Xb(),l.Xb(),l.Yb(18,"button",10),l.gc("click",(function(t){return e.Send()})),l.Mc(19,"Send"),l.Xb(),l.Xb(),l.Xb(),l.Xb(),l.Xb()),2&t&&(l.Eb(5),l.qc("ngForOf",e.contacts),l.Eb(5),l.Oc("Chat with: [",e.selectedId,"]"),l.Eb(2),l.qc("ngForOf",e.messages),l.Eb(5),l.qc("ngModel",e.message),l.Eb(1),l.qc("disabled",0==e.message.length||0==e.selectedId.length))},directives:[b.a,b.e,u.i,c.k,u.a,g.a,m.b,h.b,d.c,d.o,d.r,f.b,u.f,c.l,p.j,u.b,u.d],styles:[".chat[_ngcontent-%COMP%]{height:350px;overflow-y:scroll;overflow-wrap:inherit}.mat-option.mat-selected[_ngcontent-%COMP%]{background:red!important}.mat-option.mat-active[_ngcontent-%COMP%]{background:#00f!important}mat-list-option[aria-selected=true][_ngcontent-%COMP%]{background:rgba(0,139,139,.7)}.contacts[_ngcontent-%COMP%]{height:500px;overflow-y:scroll;overflow-wrap:inherit}.mat-pseudo-checkbox[_ngcontent-%COMP%]{display:none!important;visibility:hidden!important}"]}),_)}],I=((X=function t(){_classCallCheck(this,t)}).\u0275mod=l.Qb({type:X}),X.\u0275inj=l.Pb({factory:function(t){return new(t||X)},imports:[[o.i.forChild(A)],o.i]}),X),Y=n("M0ag");n.d(e,"ChatModule",(function(){return P}));var E,P=((E=function t(){_classCallCheck(this,t)}).\u0275mod=l.Qb({type:E}),E.\u0275inj=l.Pb({factory:function(t){return new(t||E)},imports:[[c.c,I,Y.a]]}),E)}}]);